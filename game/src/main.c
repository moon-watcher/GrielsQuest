/***
 *    - Feel free to do anything you want* with this code, consider it as PUBLIC DOMAIN -
 *               ... but be careful, this code is dark and full of terrors.
 *
 *                (*) NOT ALLOW TO USE THIS CODE FOR COMMERCIAL PURPOSES
 *
 *
 *
 *
 *              `:////-..`                                                                                                                `.-/oo:`
 *         .+yhmNNNNNNNNmh/.                                                                                                    -++ooyhhdmmmmmNNNd.
 *       /dNNddhydddNMNNNNNmo         ````````                                                                      `:ssoo/-  :hNNNmNNNNNNNNmddhoM.
 *     `yMmo::::::://smMMNNNNy`   .:ohmmmmmmmmyyyo+-`              ...`       ..///+++/..            .-/+++++-.    -dNmNNNNNy/hmNNMNmhssss+//:::yy`
 *     -Nd::::::::::::/ymMNNmmo `odNMMMNmNMMNNNNNNNmy.          `/hmmm+    ./odmmNNNNNNmmh/.     ./shddmNNNNNNmh/` :dmMNdooymmyhNMmo//:::::::::/N-
 *     oMo::::::+++/:::/omMNmdo+NNdys++///++sydmNMNNNms`     .:sdmMNMM+   /hmNMNNdddddNNNMNd-   /dddmMMMNmdddNNNNd/-hmMy/:::/NdmMdo/::::::///::/N
 *     sM-:::::+mNNm::::/sMNdy+Nd+/::::::::::://+odMMNNh    :hmNMmyoNM+  +mMNyo+////////+yNMm. :hdNMNhso///////+smNsomMy/::::NdMmo/:::/sssyoodhmo
 *     sM-::::+hNNhs::::/oMNh+hN:::::+osyo++::::::/sNMNm/  :NMmho/:/mM+ -mMmo:::::::::::::+mM+ ydMMh+::::::::::::+mMyyMm+:::hNmMd+::::oNh/`  `-o`
 *     sM-::::+dNNo:::::+hMNh/hm-::+hNMMMMNmds:::::/sMMm+  oMd//:::/mM+ sMNo::::::/+oo:::::yM+-dNMd/:::::/o+/::::/hMd:mMy::+MydMmo:::::/oyhhs+-`
 *     sM-::::+dNNNhs+ohmMNy/`oNo:/dMMMdyo++mmh+::::/dMm/  -NN+::::/mM+ yMm/::::/ymdNmo::::yM+:dMMo:::::smmm+::::+mMd sNN//ms`omMmo::::::://+sdds.
 *     sM-::::+dMdymmmNNNmhs+:/+hdysNMs/:::/mdmh:::::hMd:   /N+::::/mM+ oMm/::::/mmNd//:::/NN::dMd/::::-MMm/:::::sMm- `yMyhd`  -dNNy+/:::::::://ymo`
 *     sM-::::+dmmdmmmmmNNNNNNNd/-+ydM+::::/mmNs::::/mMy    /M+::::/mM+ `dMs:::::+hNNdyssdNNo :dMh/::::-MNNyo++sdNy-   .yNN:  ./yhmNNdyo/::::::::+Ns`
 *     sM-::::+dmMMdyhmmmNNNMNdh:   /N+::::/mdo::::/yMm.    /M+::::/mM+  -mNh/::::/+ymNMy+:.  :dMh/::::-Md+dmmmhy-      `..  +mNNmdmNNMNNdy+/:::::yN:
 *     sM-::::+dNNMm:///+osmMmh/    /N+::::///::::/hNNo     /M+::::/mM+  :mMNy:::::::/dMy     :dMh/::::-Mh `...             :mNNNNMmdyyyyNNmy+::::/M/
 *     sM-::::+dMddM:::::+yMNhh-    /N+:::::::::::/dMdh-    /M+::::/mM+ `yMms:::::::+sNm/     :dMh/::::-Mh                  +mNNMNy+//::/+mNNs+:::/M/
 *     sM/::::+dMddM:::::+hMmhh-    /N+::::://:::::sMNdo    /M+::::/mM+ -NNs::::::+dmmo.      :dMh/::::-Mh                  +dmMNs+::/sy/:hNNh+:::/M/
 *     -Nh::::/hMNNM:::::+hMmhh-    /N+::::/ym+::::oNMdh`   /M+::::/mM+ yMm/:::::/NN:`        :dMh/::::-Mh.:sys`            /hdMd+:::hNmd+MNms/:::hN:
 *      oN+::::+ymmy:::::+hMmhh-    /N+::::/mmN::::/hMNh/   /M+::::/mM+ sMm/:::::+Mm/`        :dMh/::::-MmyhdmNy.           `ydMd+:::smNNNNms/:::sNy
 *      `hmo/:::///::::::+hMmhs.    /N+::::/NmM+::::+MNds  `sM+::::/mM+ .mN+:::::/dMdy/       :dMh/::::-MNhhdNNMh`           -yMmo::::/syyo//:::oMm.
 *       `omdo/::::::::/+yNMdo`     /N+::::/NmNh::::/dMmh` +Mm/::::/mMo` +Nd::::::omMNdo.     /dMh/::::-MNdNNmsmM+            -dMd+:::::::::::+hNh-
 *         .smdy+////+sdNMmo-       yN+::::/NmNh:::::yMNh` oM/:::::/mMdo  hMs::::::+dMNNdo`   hdMh/::::-mdhho+:yMN:            -dNmy+///::/+shNmo`
 *           ./yhhhhhdmhy/`        `md:::::/dNMy+o+//oNN+  oM/:::::/mMmy  `hMo::::::/ymMMN+  :mmMh/::::://:::::/dMs             `+dMNddddhmNmy+.
 *               ``````            oNs:///ossmNmdhdddmNh`  +Nh-::::/dMMs   .yNh/::::::/yNMm. +dNMh/:::::::::::::sMN`              `:oshhhs+-.
 *                                .mdoyhdhdyyyso/``....`    md-:://omNm+     oNmo:::::::yMM/ .dMm/////////++++yyhNm`
 *                                `+ss+-``/++////-         -Nd-+hdmmy+.       :dMy/::::/mNo   smdhhhhhhhdddddhyy+/.
 *                                        `oys+:-.`        oMshNms-`           `yNNy/:omNo     `````.-/+osyso:/:
 *                                         :/oosoos+/-.````+NNh:.                -yNNhNm: ```.----/oyyysso++/::
 *                                        `+:/++++///ososssshho++++++/::::::::++++oydNms++ossyyyyssso+:-..++:/`
 *                                      `-/++-++:` `` ./++++ooossssyyyyyyyyyyyyyyyyyysso::::/+++:--.. `::++:/:
 *                                     ./++++-:/` /++: `/:``-++++--++-.-:////:--.-+++:` .:-- .++.`::``/+oso:++.
 *                                     .-:://.o+ -++++` -/- `/+++- -+/.  ::::::- `/+-  /++:` .+++++/ -oyyyy:-++:.
 *                                          `:yo`:yyys+ -++- -++++` /++- -++++++/+++:. `--///++++os: oyyyyys.```
 *                                          -yyy/ :syy- +yso .o+++- /++- -++++:/++++++/:-`  -sssyyy- yyyyyyy+`
 *                                         `+yyyys-`..`+ysyy .yyys- oyy` ::....syyys::syyys- +yyyyy- yyyyyys-
 *                                           `.:+yyyso..- -y- /sy: :yyy``yyyyyyyyyy+ `syyyy/`oyyyyy//yyys/-`
 *                                                -/oyyyyyyyy+.```/yys.` /ys+++:-oyy/`.---`:syyyyyys++-`
 *                                                   `..:oossyysoyyyyyoyo-..////+yyyyyooosyyyss+:.`
 *                                                           ``.-:/+oosyyyyyyyyyyyysooo+::-``
 *
 *
 *
 * Original game by Karoshi Corporation, released for MSX, CHECK OUT THIS! [http://karoshi.auic.es/]
 *
 * @CODE:                     =>  Mun                           | Twitter: @MoonWatcherMD     | Mail:                     |Notes: do you like puzzles? Try Poplis for Gamegear
 * @PROJECT:                  =>  #GrielsQuestMD
 * @START-DATE:               =>  20130509
 * @LAST-UPDATE:              =>  20170803
 * @LIB:                      =>  SGDK (v1.22a) by Stephane Dallongeville
 *
 *
 *
 * --------------------------------------------------------------------------------------------------------------------------------
 *  SPECIAL THANKS TO
 * --------------------------------------------------------------------------------------------------------------------------------
 *
 * @GRAPHICS                  => Dani Nevado                    | Twitter: @DanySnowyman      | Mail:                     |Notes:
 * @MUSIC                     => David Sánchez                  | Twitter: @DavidBonus        | Mail:                     |Notes:
 * @SFX                       => David Sánchez                  | Twitter: @DavidBonus        | Mail:                     |Notes:
 *
 * @ENGLISH-TRANSLATION       => Felipe Monge Corbalán          | Twitter: @vakapp            | Mail:                     |Notes:
 * @ITALIAN-TRANSLATION       => DaRkHoRaCe                     | Twitter: @oongamoonga       | Mail:                     |Notes:
 * @FRENCH-TRANSLATION        => KanedaFr                       | Twitter: @SpritesMind      ‏ | Mail:                     |Notes:
 * @CATALAN-TRANSLATION       => Jordi Montornés Solé           | Twitter: @jordimontornes   ‏ | Mail:                     |Notes:
 * @FINNISH-TRANSLATION       => Natsumi                        | Twitter:                    | Mail:                     |Notes:
 * @GALEGO-TRANSLATION        => Paspallas                      | Twitter: @PaspallasDev      | Mail:                     |Notes:
 * @BR-PORTUGUESE-TRANSLATION => Thiago F. Alves                | Twitter:                    | Mail:                     |Notes:
//         * @ESPERANTO-TRANSLATION     => teaduckie                      | Twitter:                    | Mail:                     |Notes:
//         * @INTERLINGUA-TRANSLATION   => teaduckie                      | Twitter:                    | Mail:                     |Notes:

 * @BETA-TESING               => Alfonso Martínez               | Twitter: @_SrPresley_       | Mail:                     |Notes:
 *
 * @SPECIAL-THANKS-TO         => Bruce Rodríguez                | Twitter: @emigrantebruce    | Mail:                     |Notes:
 * @SPECIAL-THANKS-TO         => Eduardo Robsy                  | Twitter: @EduRobsy    ‏      | Mail:                     |Notes:
 * @SPECIAL-THANKS-TO         => Jon Cortazar                   | Twitter: @Jon_Cortazar   ‏   | Mail:                     |Notes: #DietaTorreznos
 *
 * @ENGLISH-REVIEWER          => Clare Eddleston                | Twitter:                 ‏   | Mail:                     |Notes:
 * @ENGLISH-REVIEWER          => Xavier Bravo                   | Twitter:                 ‏   | Mail:                     |Notes:
 *
 *
 *
 * --------------------------------------------------------------------------------------------------------------------------------
 *  1985 ALTERNATIVO'S PHYSICAL RELEASE
 * --------------------------------------------------------------------------------------------------------------------------------
 *
 * @ILLUSTRATIONS             => Dani Nevado                    | Twitter: @DanySnowyman      | Mail:                     |Notes:
 * @COVER                     => Dani Nevado                    | Twitter: @DanySnowyman      | Mail:                     |Notes:
 * @INSTRUCTION-MANUAL        => Alfonso Martínez               | Twitter: @_SrPresley_       | Mail:                     |Notes:
 *
 *
 *
 * --------------------------------------------------------------------------------------------------------------------------------
 *  HOW TO COMPILE
 * --------------------------------------------------------------------------------------------------------------------------------
 *
 * Sega Genesis/Megadrive version of Griel's Quest for the Holy Porron was created using SGDK v1.22a and GenRes v1.1.
 *
 *  - Go gendev.spritesmind.net/page-genres.html
 *  - Download GenRes v1.1
 *  - Extract and replace all genres.* files in the zip into SGDK's bin directory
 *  - Compile #GrielsQuestMD
 *  - Ta-dah!
 *
 *
 *
 * --------------------------------------------------------------------------------------------------------------------------------
 *  KNOWN BUGS
 * --------------------------------------------------------------------------------------------------------------------------------
 *
 * -
 * -
 *
 *
 *
 * --------------------------------------------------------------------------------------------------------------------------------
 *  CHANGELOG
 * --------------------------------------------------------------------------------------------------------------------------------
 * 19-04-2017 » First release
 * 03-08-2017 » Works stunning on real hard
 * 25-07-2018 » Free and public release
 * --------------------------------------------------------------------------------------------------------------------------------
 */

#include "../inc/include.h"

void monos()
{
   JoyReader_update();

   if (!joy1_pressed_btn)
   {
      return;
   }

   SYS_disableInts();
   VDP_loadTileSet(ob_title_monos_mi.tileset, 16, 0);
   PAL_setPalette(PAL1, ob_title_monos_mi.palette->data, CPU);
   SYS_enableInts();

   u16 x = 0;
   u16 y = 0;

   while (1)
   {
      SYS_disableInts();
      VDP_setMapEx(BG_A, ob_title_monos_mi.tilemap, TILE_ATTR_FULL(PAL1, 0, 0, 0, 16), 14, 10, x * 13, y * 6, 13, 6);
      SYS_enableInts();

      ++x;

      if (x == 10)
      {
         x = 0;
         ++y;
      }

      if (x == 6 && y == 6)
      {
         x = 0;
         y = 0;
      }

      JoyReader_update();

      if (joy1_pressed_btn)
      {
         break;
      }

      SYS_doVBlankProcess();
      SYS_doVBlankProcess();
      SYS_doVBlankProcess();
      SYS_doVBlankProcess();
      SYS_doVBlankProcess();
      SYS_doVBlankProcess();
   }

   displayOff(30);
}

int main()
{
   displayInit();
   gamestate_init(); // debe estar aqui y tras introducir un password correcto
   JoyReader_init(1);

   // 0: disclaimer
   // 1: SEGA
   // 2: publisher
   // 3: Oook!Lab
   // 4: languages
   // 5: intro
   // 6: title
   // 7: map
   dev_init(6);
   
   if (DEV)
   {
      gamestate.dificultad = 3; // 2 // 1 // 0
      gamestate.ambientes[0] = gamestate.ambientes[1] = gamestate.ambientes[2] = gamestate.ambientes[3] = 14;  // 5 // 6
      gamestate.ambientes[4] = 6; // 3 // 0
      gamestate.visito_la_puerta = true; // false
      
      if (DEV > 4)
            gamestate.lenguaje = FINNISH; // FINNISH // ENGLISH // SPANISH // FRENCH
   }

   monos();

   // todas_las_pantallas ( );
   // object_viewer();
   // conio();

   XGM_setForceDelayDMA(true);
   VDP_setPlaneSize(64, 32, false);

   JOY_init();
   JOY_setSupport(PORT_1, DEV ? JOY_SUPPORT_6BTN : JOY_SUPPORT_3BTN);
   JOY_setSupport(PORT_2, JOY_SUPPORT_OFF);

   SYS_setVIntCallback((VoidCallback *)vint_callback);

   vint_init();
   font_init();
   resetPalettes();
   resetScroll();
   resetSprites();
   resetScreen();

   if (DEV < ++gamestate.localdev) // 0
   {
      if (gamestate.nolddor_released_ZoS)
         screen_disclaimer_cool(
             TILE_USER_INDEX,
             (IS_PAL_SYSTEM ? 50 : 60) * 4,
             ({ int j(){ JoyReader_update(); return joy1_pressed_abc | joy1_pressed_start; }; j; }));
      else
         screen_disclaimer_simple();

      displayOff(0);
   }

   if (DEV < ++gamestate.localdev) // 1
   {
      screen_sega();
   }

   if (DEV < ++gamestate.localdev) // 2
   {
      if (gamestate.publisher == 1)
         screen_publisher_1985();

      if (gamestate.publisher == 2)
         screen_publisher_POR();
   }

   if (DEV < ++gamestate.localdev) // 3
   {
      screen_oooklab();
   }

   if (DEV < ++gamestate.localdev) // 4
   {
      screen_languages();
   }
   else
   {
      if (!gamestate.lenguaje)
         gamestate.lenguaje = ENGLISH;
   }


   //        screen_final(0);
   //        screen_staff();
   //        screen_oldintro();

   // http://www.dodgycoder.net/2012/02/coding-tricks-of-game-developers.html#
   __builtin_expect(gamestate.current_ambiente, 0);

	while(1)
      game_main_step();

   return 0;
}